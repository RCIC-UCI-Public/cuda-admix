!include cuda-common.yaml
!include rpm.yaml
---
- package: CUDA toolkit
  name: "{{basename}}" 
  src_tarball: "{{cuda.src_tarball}}" 
  baserpm: "{{name}}_{{cuda.shortversion}}"
  description: >
    CUDA Version {{cuda.version}}
  addfile: 
    - filter-requires-{{name}}.sh
  tmpdir: $(REDHAT.BUILD)/cudaTmp
  contents: bin  EULA.txt  include  lib64 libnvvp nvml share targets version.txt jre nvvm src tools
  build:
    configure: echo no configure required 
    pkgmake: >
      if [ -d {{extractDir}} ]; then /bin/rm -rf {{extractDir}}; fi;
      mkdir {{tmpdir}}; mkdir {{extractDir}};
      export TMPDIR={{tmpdir}};
      sh {{src_tarball}} --extract={{extractDir}}
  install:
    makeinstall: >
      for x in {{contents}}; do  cp -pR {{extractDir}}/{{basename}}/$$x $(ROOT){{root}}; done
  requires: ""
  rpmFilters: *filterRequires
